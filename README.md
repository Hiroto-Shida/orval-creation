## (æ¸ˆ) Next.js ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
npx create-next-app@latest --yes --empty orval-creation
```

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```
npm run dev
```

- ç”»é¢(http://localhost:3000)ã«ã€ŒHello world!ã€ãŒã§ã¦ãã‚Œã° OK

## (æ¸ˆ) orval ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
npm i -D orval
```

## (æ¸ˆ) ãã®ä»–å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
npm i hono zod @modelcontextprotocol/sdk @hono/zod-validator
```

## (æ¸ˆ) orval ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« `orval.config.ts` ã¨ OpenAPI ã®ã‚¹ã‚­ãƒ¼ãƒ `schemas.yaml` ã‚’ç”¨æ„

```diff
/
  â”œâ”€ app/
  â”œâ”€ node_modules
+ â”œâ”€ orval.config.ts
  â”œâ”€ package-lock.json
  â”œâ”€ package.json
+ â”œâ”€ schemas.yaml
  â””â”€ tsconfig.json
```

## orval ã®ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

### `package.json`

```diff
{
  "scripts": {
+    "generate": "orval --config ./orval.config.ts"
  },
```

### ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

```
npm run generate
```

ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

```diff
/
  â”œâ”€ app/
+ â”‚  â”œâ”€ api/
+ â”‚  â”‚  â””â”€ [[...route]]/
+ â”‚  â”‚     â””â”€ route.ts
  â”‚  â””â”€ page.tsx
+ â”œâ”€ client/
+ â”‚  â””â”€ api.ts
+ â”œâ”€ endpoints/
+ â”‚  â”œâ”€ colorful-moai/
+ â”‚  â”‚  â””â”€ ...
+ â”‚  â””â”€ validator.ts
+ â”œâ”€ mcp
+  â”‚  â”œâ”€ handlers.ts
+  â”‚  â”œâ”€ http-client.ts
+  â”‚  â”œâ”€ server.ts
+  â”‚  â””â”€ tool-schemas.zod.ts
  â”œâ”€ node_modules
+ â”œâ”€ schemas/
+ â”‚  â”œâ”€ index.ts
+ â”‚  â””â”€ ...
  â”œâ”€ orval.config.ts
  â”œâ”€ package-lock.json
  â”œâ”€ package.json
  â”œâ”€ schemas.yaml
  â””â”€ tsconfig.json
```

## API å‘¨ã‚Šã®å‡¦ç†ã‚’ã¡ã‚‡ã£ã¨ã ã‘å®Ÿè£…

è‡ªå‹•ç”Ÿæˆã® hono ã¯ã‚ãã¾ã§é››å½¢(ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ)ãŒã§ãã‚‹ã ã‘ãªã®ã§å®Ÿéš›ã®å®Ÿè£…ã¯å¿…è¦

### Next.js ã® API Route ã® hono å®Ÿè£…ã«ã¡ã‚‡ã£ã¨è¿½åŠ 

#### `app/api/[[...route]]/route.ts`

```diff:ts
/**
 * Generated by orval v7.9.0 ğŸº
 * Do not edit manually.
 * ã‚«ãƒ©ãƒ•ãƒ«ãƒ¢ã‚¢ã‚¤API
 * ã‚«ãƒ©ãƒ•ãƒ«ãªãƒ¢ã‚¢ã‚¤ã®ãƒªã‚¹ãƒˆã‚’ç®¡ç†ã™ã‚‹APIã€‚
 * OpenAPI spec version: 1.0.0
 */
  import { Hono } from "hono";
  import {
    getColorfulMoaiHandlers,
    addColorfulMoaiHandlers,
  } from "../../../endpoints/colorful-moai/colorful-moai.handlers";
+ import { handle } from "hono/vercel";

- const app = new Hono();
+ const app = new Hono().basePath("/api");

  app.get("/colorful-moai", ...getColorfulMoaiHandlers);
  app.post("/colorful-moai", ...addColorfulMoaiHandlers);

- export default app;

+ export const GET = handle(app)
+ export const POST = handle(app)

```

### API ã«ç¹‹ãè¾¼ã¿

`endpoints/colorful-moai/colorful-moai.handlers.ts`

```diff:ts
...
+ const COLORFUL_MOAI_LIST = ["èµ¤ãƒ¢ã‚¢ã‚¤", "ç·‘ãƒ¢ã‚¢ã‚¤", "é’ãƒ¢ã‚¢ã‚¤"];

  const factory = createFactory();
  export const getColorfulMoaiHandlers = factory.createHandlers(
    zValidator("response", getColorfulMoaiResponse),
    async (c: GetColorfulMoaiContext) => {
+     return c.json(COLORFUL_MOAI_LIST);
    }
  );
  export const addColorfulMoaiHandlers = factory.createHandlers(
    zValidator("json", addColorfulMoaiBody),
    zValidator("response", addColorfulMoaiResponse),
    async (c: AddColorfulMoaiContext) => {
+     const body = await c.req.json();

+     COLORFUL_MOAI_LIST.push(body["name"]);

+     return c.json(COLORFUL_MOAI_LIST);
    }
  );

```

## ç”»é¢ã‹ã‚‰ API å‘¼ã³å‡ºã— (API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)

### `app/page.tsx`ã« API å‘¼ã³å‡ºã—ã‚’è¿½åŠ 

```diff:tsx
+ import { getColorfulMoai } from "@/client/api";

- export default function Home() {
+ export default async function Home() {
+   const res = await getColorfulMoai({
+     cache: "no-cache",
+   });

    return (
      <main>
-       <div>Hello world!</div>
+       <div>{JSON.stringify(res.data)}</div>
      </main>
    );
  }
```

## Cursor ã¨ MCP ã‚’æ¥ç¶š

### (æ¸ˆ) mcp.json ã‚’ä½œæˆ

```diff
/
+ â”œâ”€ .cursor/
+ â”‚  â””â”€ mcp.json
  â”œâ”€ app/
  â”‚  â”œâ”€ api/
...
```

### mcp.json ã‚’è‡ªèº«ã®ç’°å¢ƒã«åˆã‚ã›ã¦æ›¸ãæ›ãˆ

```diff:json
{
  "mcpServers": {
    "colorsAPIServer": {
      "command": "npx",
      "args": [
        "tsx",
+       "~~~~~~~~/mcp/server.ts" // çµ¶å¯¾ãƒ‘ã‚¹ã«ã™ã‚‹
      ]
    }
  }
}
```

### mcp.json ã®è¨­å®šã‚’ cursor ã«å®Ÿéš›ã«æ¥ç¶šã™ã‚‹

`.cursor/mcp.json` ã‚’è¨­å®šã™ã‚‹ã¨ã€Cursor Settings > MCP > MCP Servers ã«ã‚«ãƒ¼ãƒ‰ãŒç¾ã‚Œã€enable ã«ã—ã¦ç·‘ã«ç‚¹ç¯ã™ã‚Œã°æ¥ç¶šå®Œäº†

- ã†ã¾ãã„ã‹ãªã„æ™‚ã¯ server.ts ãŒçµ¶å¯¾ãƒ‘ã‚¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
- cursor ã‚’å†èµ·å‹•ã™ã‚‹ç­‰ã‚’ã™ã‚‹

## Next.js (API ã‚µãƒ¼ãƒ) ã‚’èµ·å‹•ã—ã¦ MCP ã‚’é€šã—ã¦ æ¥ç¶šã—ã¦ã¿ã‚‹

```
npm run dev
```
